'use client'
import { useData } from '@/components/data-provider'
import { C, MO, Stt, DC, PIC } from '@/components/ui'
import { BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, Tooltip, ResponsiveContainer } from 'recharts'

export default function AnalyticsPage(){const{emps,ana}=useData();const sr=(()=>{const r={'<40k':0,'40-60k':0,'60-80k':0,'80-100k':0,'100k+':0};emps.forEach(e=>{const s=e.salary||0;if(s<40000)r['<40k']++;else if(s<60000)r['40-60k']++;else if(s<80000)r['60-80k']++;else if(s<100000)r['80-100k']++;else r['100k+']++});return Object.entries(r).map(([range,count])=>({range,count}))})();const dd=Object.entries(ana.ds).map(([name,value])=>({name,value,color:DC[name]||C.txD}));return<div><h1 style={{fontSize:20,fontWeight:700,marginBottom:20}}>Analytics</h1><div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:10,marginBottom:18}}><Stt label="Headcount" value={ana.total} icon="users"/><Stt label="Active" value={ana.active} icon="check"/><Stt label="Avg Salary" value={'€'+Math.round(ana.avgSal/1000)+'k'} icon="dollar"/><Stt label="Depts" value={Object.keys(ana.ds).length} icon="building"/></div><div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}><div style={{background:C.bgE,border:`1px solid ${C.bd}`,borderRadius:10,padding:18}}><div style={{fontSize:12,fontWeight:600,marginBottom:14}}>Salary (€)</div><ResponsiveContainer width="100%" height={180}><BarChart data={sr}><XAxis dataKey="range" tick={{fill:C.txD,fontSize:10}} axisLine={false} tickLine={false}/><YAxis tick={{fill:C.txD,fontSize:10}} axisLine={false} tickLine={false} allowDecimals={false}/><Tooltip contentStyle={{background:C.bgC,border:`1px solid ${C.bd}`,borderRadius:8,fontSize:11}}/><Bar dataKey="count" fill={C.pu} radius={[4,4,0,0]}/></BarChart></ResponsiveContainer></div><div style={{background:C.bgE,border:`1px solid ${C.bd}`,borderRadius:10,padding:18}}><div style={{fontSize:12,fontWeight:600,marginBottom:14}}>By Department</div>{dd.length?<><ResponsiveContainer width="100%" height={160}><PieChart><Pie data={dd} cx="50%" cy="50%" innerRadius={35} outerRadius={60} paddingAngle={3} dataKey="value" stroke="none">{dd.map((d,i)=><Cell key={i} fill={d.color}/>)}</Pie><Tooltip contentStyle={{background:C.bgC,border:`1px solid ${C.bd}`,borderRadius:8,fontSize:11}}/></PieChart></ResponsiveContainer><div style={{display:'flex',flexWrap:'wrap',gap:8,justifyContent:'center'}}>{dd.map(d=><div key={d.name} style={{display:'flex',alignItems:'center',gap:4,fontSize:10,color:C.txD}}><div style={{width:6,height:6,borderRadius:2,background:d.color}}/>{d.name}({d.value})</div>)}</div></>:<div style={{color:C.txD}}>No data</div>}</div></div></div>}
