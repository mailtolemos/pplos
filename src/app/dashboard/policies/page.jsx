'use client'
import { useState } from 'react'
import { useData } from '@/components/data-provider'
import { C, MO, Bg, Btn, Inp, Tbl, Ety, Modal } from '@/components/ui'

function PolForm({onSave}){const[tl,setTl]=useState('');const[ct,setCt]=useState('General');const[cn,setCn]=useState('');return<div style={{display:'flex',flexDirection:'column',gap:12}}><Inp label="Title" value={tl} onChange={setTl} placeholder="Remote Work Policy" required/><Inp label="Category" value={ct} onChange={setCt} options={['General','HR','IT','Finance','Legal']}/><Inp label="Content" value={cn} onChange={setCn} textarea/><Btn v="primary" onClick={()=>tl&&onSave({title:tl,category:ct,content:cn})} disabled={!tl} style={{width:'100%',justifyContent:'center'}}>Create</Btn></div>}

export default function PoliciesPage(){const{emps,pols,addPol,pubPol,ackPol,delPol}=useData();const[modal,setModal]=useState(false);return<div><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:20}}><h1 style={{fontSize:20,fontWeight:700}}>Policies</h1><Btn v="primary" icon="plus" onClick={()=>setModal(true)}>New</Btn></div><Tbl cols={[{label:'Policy',render:r=><div><div style={{fontWeight:500,fontSize:12}}>{r.title}</div><div style={{fontSize:10,color:C.txD}}>{r.category}Â·v{r.version}</div></div>},{label:'Status',render:r=><Bg v={r.status==='published'?'green':'amber'}>{r.status}</Bg>},{label:"Ack'd",render:r=>{const a=(r.acknowledgements||[]).length;return<div style={{display:'flex',alignItems:'center',gap:6}}><div style={{width:50,height:5,background:C.bd,borderRadius:3,overflow:'hidden'}}><div style={{height:'100%',width:`${emps.length?(a/emps.length*100):0}%`,background:a===emps.length?C.gn:C.am,borderRadius:3}}/></div><span style={{fontFamily:MO,fontSize:10,color:C.txD}}>{a}/{emps.length}</span></div>}},{label:'',render:r=><div style={{display:'flex',gap:4}}>{r.status==='draft'&&<Btn v="primary" sz="xs" icon="check" onClick={()=>pubPol(r.id)}>Publish</Btn>}{r.status==='published'&&<Btn v="ghost" sz="xs" onClick={()=>{const u=emps.filter(e=>!(r.acknowledgements||[]).includes(e.id));if(u.length)ackPol(r.id,u[0].id)}}>Sign</Btn>}<Btn v="danger" sz="xs" icon="trash" onClick={()=>delPol(r.id)}>Del</Btn></div>}]} data={pols} empty={<Ety icon="file" message="No policies" action="Create" onAction={()=>setModal(true)}/>}/><Modal open={modal} onClose={()=>setModal(false)} title="Create Policy"><PolForm onSave={async d=>{await addPol(d);setModal(false)}}/></Modal></div>}
