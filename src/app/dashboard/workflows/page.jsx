'use client'
import { useState } from 'react'
import { useData } from '@/components/data-provider'
import { C, MO, Btn, Inp, Tbl, Ety, Modal, Tog } from '@/components/ui'

function WfForm({onSave}){const tgs=['employee.created','employee.terminated','contract.expiring','leave.requested','shift.conflict'];const acs=['send_email','send_slack','create_task','notify','webhook'];const[nm,setNm]=useState('');const[tg,setTg]=useState(tgs[0]);const[ac,setAc]=useState(acs[0]);const[ds,setDs]=useState('');return<div style={{display:'flex',flexDirection:'column',gap:12}}><Inp label="Name" value={nm} onChange={setNm} placeholder="Onboarding" required/><Inp label="Trigger" value={tg} onChange={setTg} options={tgs}/><Inp label="Action" value={ac} onChange={setAc} options={acs}/><Inp label="Description" value={ds} onChange={setDs} textarea/><Btn v="primary" onClick={()=>nm&&onSave({name:nm,trigger_event:tg,action_type:ac,description:ds})} disabled={!nm} style={{width:'100%',justifyContent:'center'}}>Create</Btn></div>}

export default function WorkflowsPage(){const{wfs,addWf,togWf,delWf}=useData();const[modal,setModal]=useState(false);return<div><div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:20}}><h1 style={{fontSize:20,fontWeight:700}}>Workflows</h1><Btn v="primary" icon="plus" onClick={()=>setModal(true)}>New</Btn></div><Tbl cols={[{label:'Workflow',render:r=><div><div style={{fontWeight:500,fontSize:12}}>{r.name}</div><div style={{fontSize:10,color:C.txD,fontFamily:MO}}>{r.trigger_event}â†’{r.action_type}</div></div>},{label:'Status',render:r=><div style={{display:'flex',alignItems:'center',gap:6}}><Tog on={r.is_active} onToggle={()=>togWf(r.id)}/><span style={{fontSize:11,color:r.is_active?C.gn:C.txD}}>{r.is_active?'Active':'Off'}</span></div>},{label:'',render:r=><Btn v="danger" sz="xs" icon="trash" onClick={()=>delWf(r.id)}>Del</Btn>}]} data={wfs} empty={<Ety icon="zap" message="No workflows" action="Create" onAction={()=>setModal(true)}/>}/><Modal open={modal} onClose={()=>setModal(false)} title="Create Workflow"><WfForm onSave={async d=>{await addWf(d);setModal(false)}}/></Modal></div>}
